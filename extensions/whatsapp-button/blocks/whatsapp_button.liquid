{% if block.settings.phone_number != blank %}
<style>
  .whatsapp-float-button {
    position: fixed;
    {% if block.settings.position == 'bottom-right' %}
      bottom: {{ block.settings.bottom_spacing }}px;
      right: {{ block.settings.side_spacing }}px;
    {% elsif block.settings.position == 'bottom-left' %}
      bottom: {{ block.settings.bottom_spacing }}px;
      left: {{ block.settings.side_spacing }}px;
    {% elsif block.settings.position == 'top-right' %}
      top: {{ block.settings.top_spacing }}px;
      right: {{ block.settings.side_spacing }}px;
    {% elsif block.settings.position == 'top-left' %}
      top: {{ block.settings.top_spacing }}px;
      left: {{ block.settings.side_spacing }}px;
    {% endif %}
    width: {{ block.settings.button_size }}px;
    height: {{ block.settings.button_size }}px;
    background-color: {{ block.settings.button_color }};
    border-radius: {{ block.settings.border_radius }}%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    cursor: pointer;
    z-index: 9999;
    transition: all 0.3s ease;
    text-decoration: none;
  }
  
  .whatsapp-float-button:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
  }
  
  .whatsapp-float-button svg {
    width: {{ block.settings.icon_size }}%;
    height: {{ block.settings.icon_size }}%;
    fill: {{ block.settings.icon_color }};
  }
  
  .whatsapp-tooltip {
    position: absolute;
    {% if block.settings.position contains 'right' %}
      right: calc(100% + 15px);
    {% else %}
      left: calc(100% + 15px);
    {% endif %}
    top: 50%;
    transform: translateY(-50%);
    background-color: {{ block.settings.tooltip_bg_color }};
    color: {{ block.settings.tooltip_text_color }};
    padding: 10px 15px;
    border-radius: 8px;
    white-space: nowrap;
    font-size: 14px;
    font-weight: 500;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  .whatsapp-float-button:hover .whatsapp-tooltip {
    opacity: 1;
  }
  
  @media (max-width: 768px) {
    .whatsapp-float-button {
      width: {{ block.settings.mobile_button_size }}px;
      height: {{ block.settings.mobile_button_size }}px;
      {% if block.settings.position == 'bottom-right' or block.settings.position == 'bottom-left' %}
        bottom: {{ block.settings.mobile_bottom_spacing }}px;
      {% endif %}
      {% if block.settings.position == 'bottom-right' or block.settings.position == 'top-right' %}
        right: {{ block.settings.mobile_side_spacing }}px;
      {% else %}
        left: {{ block.settings.mobile_side_spacing }}px;
      {% endif %}
    }
    
    .whatsapp-tooltip {
      display: none;
    }
  }
</style>

{% assign phone_clean = block.settings.phone_number | replace: ' ', '' | replace: '-', '' | replace: '(', '' | replace: ')', '' | replace: '+', '' %}
{% assign default_message = block.settings.default_message | url_encode %}
{% assign whatsapp_url = 'https://wa.me/' | append: phone_clean %}
{% if block.settings.default_message != blank %}
  {% assign whatsapp_url = whatsapp_url | append: '?text=' | append: default_message %}
{% endif %}

<a href="{{ whatsapp_url }}" 
   class="whatsapp-float-button" 
   target="_blank" 
   rel="noopener noreferrer"
   aria-label="{{ 'whatsapp.button_aria_label' | t }}">
  <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
    <path d="M16 0c-8.837 0-16 7.163-16 16 0 2.825 0.737 5.607 2.137 8.048l-2.137 7.952 8.135-2.135c2.369 1.313 5.061 2.135 7.865 2.135 8.837 0 16-7.163 16-16s-7.163-16-16-16zM16 29.333c-2.547 0-5.053-0.747-7.2-2.133l-0.507-0.32-5.227 1.373 1.4-5.173-0.347-0.533c-1.515-2.24-2.32-4.82-2.32-7.547 0-7.36 5.973-13.333 13.333-13.333s13.333 5.973 13.333 13.333c0 7.36-5.973 13.333-13.333 13.333z"/>
    <path d="M23.547 19.787c-0.373-0.187-2.213-1.093-2.56-1.213-0.347-0.133-0.6-0.187-0.853 0.187s-0.973 1.213-1.2 1.467c-0.213 0.253-0.44 0.28-0.813 0.093s-1.587-0.587-3.013-1.853c-1.12-0.987-1.867-2.213-2.080-2.587s-0.027-0.573 0.16-0.76c0.173-0.173 0.373-0.44 0.56-0.667 0.187-0.213 0.253-0.373 0.373-0.627 0.133-0.253 0.067-0.48-0.027-0.667s-0.853-2.053-1.173-2.813c-0.307-0.747-0.627-0.64-0.853-0.653-0.213-0.013-0.467-0.013-0.72-0.013s-0.667 0.093-1.013 0.467c-0.347 0.373-1.333 1.307-1.333 3.187s1.36 3.693 1.547 3.947c0.187 0.253 2.613 3.987 6.333 5.587 0.88 0.387 1.573 0.613 2.107 0.787 0.893 0.28 1.707 0.24 2.347 0.147 0.72-0.107 2.213-0.907 2.533-1.773 0.307-0.88 0.307-1.627 0.213-1.773s-0.333-0.253-0.707-0.44z"/>
  </svg>
  {% if block.settings.show_tooltip %}
    <span class="whatsapp-tooltip">{{ block.settings.tooltip_text }}</span>
  {% endif %}
</a>
{% endif %}

{% schema %}
{
  "name": "WhatsApp Button",
  "target": "body",
  "settings": [
    {
      "type": "header",
      "content": "WhatsApp Settings"
    },
    {
      "type": "text",
      "id": "phone_number",
      "label": "Phone Number",
      "info": "Enter with country code (e.g., 1234567890 or +1 234 567 8900)"
    },
    {
      "type": "textarea",
      "id": "default_message",
      "label": "Default Message",
      "info": "Pre-filled message when chat opens",
      "default": "Hi! I'm interested in your products."
    },
    {
      "type": "header",
      "content": "Button Style"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button Background Color",
      "default": "#25D366"
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "Icon Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "button_size",
      "label": "Button Size (Desktop)",
      "min": 40,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "mobile_button_size",
      "label": "Button Size (Mobile)",
      "min": 40,
      "max": 80,
      "step": 5,
      "unit": "px",
      "default": 50
    },
    {
      "type": "range",
      "id": "icon_size",
      "label": "Icon Size",
      "min": 50,
      "max": 80,
      "step": 5,
      "unit": "%",
      "default": 60
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Button Roundness",
      "min": 0,
      "max": 50,
      "step": 5,
      "unit": "%",
      "default": 50
    },
    {
      "type": "header",
      "content": "Position"
    },
    {
      "type": "select",
      "id": "position",
      "label": "Button Position",
      "options": [
        { "value": "bottom-right", "label": "Bottom Right" },
        { "value": "bottom-left", "label": "Bottom Left" },
        { "value": "top-right", "label": "Top Right" },
        { "value": "top-left", "label": "Top Left" }
      ],
      "default": "bottom-right"
    },
    {
      "type": "range",
      "id": "bottom_spacing",
      "label": "Bottom Spacing (Desktop)",
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "top_spacing",
      "label": "Top Spacing (Desktop)",
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "side_spacing",
      "label": "Side Spacing (Desktop)",
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "mobile_bottom_spacing",
      "label": "Bottom Spacing (Mobile)",
      "min": 10,
      "max": 80,
      "step": 5,
      "unit": "px",
      "default": 15
    },
    {
      "type": "range",
      "id": "mobile_side_spacing",
      "label": "Side Spacing (Mobile)",
      "min": 10,
      "max": 80,
      "step": 5,
      "unit": "px",
      "default": 15
    },
    {
      "type": "header",
      "content": "Tooltip"
    },
    {
      "type": "checkbox",
      "id": "show_tooltip",
      "label": "Show Tooltip on Hover",
      "default": true
    },
    {
      "type": "text",
      "id": "tooltip_text",
      "label": "Tooltip Text",
      "default": "Chat with us on WhatsApp!"
    },
    {
      "type": "color",
      "id": "tooltip_bg_color",
      "label": "Tooltip Background Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "tooltip_text_color",
      "label": "Tooltip Text Color",
      "default": "#ffffff"
    }
  ]
}
{% endschema %}

